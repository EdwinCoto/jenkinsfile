pipeline {
    agent any

    stages {
        stage('Hello') {
            steps {
                script {
                         String projectYaml   = "${WORKSPACE}/data.yaml"
                         def data      = readYaml file: projectYaml

                         def modules             = data.'globalModules' ?:  steps.error("You need to set globalModules in modules.yaml")
                         //def mainProject         = data.'mainProject' ?: steps.error("You need to set mainProject in modules.yaml")
                         //def iosPodSpecs         = data.'iosPodSpecs' ?: steps.error("You need to set iosPodSpecs in modules.yaml")
                         //def sonarqubeProjectKey = data.'sonarqubeProjectKey' ?: steps.error("You need to set sonarqubeProjectKey in modules.yaml")
                         echo "Modules: ${modules}"
                         
                        echo "Type: ${modules.getClass()}"
                        echo "Type name: ${modules.getClass().getName()}"
                        echo "Simple name: ${modules.getClass().getSimpleName()}"

                        modules.each { moduleName, moduleData ->
                            steps.echo """
                            Module Name:       ${moduleName}
                            Main Project:      ${moduleData.mainproject}
                            iOS Podspec:       ${moduleData.iospodspec}
                            Sonar Project Key: ${moduleData.sonarqubeprojectkey}
                            """.stripIndent()
                        }
                        def modulename = "Kmp-module1"
                        def sonarKey= modules.modulename.'sonarqubeprojectkey'
                        echo "Sonar Key for ${modulename}: ${sonarKey}"

                }
            }
        }
    }
}
